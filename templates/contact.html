{% extends "base.html" %}

{% block header %}
<style>
  /* Optional: Specific tweaks for the contact card if needed, 
     otherwise it inherits the polished look of your other forms. */
  .form-control:focus {
    z-index: 2;
  }
</style>

<header
  class="masthead"
  style="background-image: url('{{ url_for('static', filename='assets/img/contact-bg.jpg') }}')"
>
  <div class="container position-relative px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7">
        <div class="page-heading">
          <h1>Contact Me</h1>
          <span class="subheading">Have questions? I have answers.</span>
        </div>
      </div>
    </div>
  </div>
</header>
{% endblock %}

{% block content %}
<main class="mb-4">
  <div class="container px-4 px-lg-5">
    <div class="row gx-4 gx-lg-5 justify-content-center">
      <div class="col-md-10 col-lg-8 col-xl-7" id="contactFormSection">

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show shadow-sm mb-4" role="alert">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <div class="card border-0 shadow rounded-3 my-3">
            <div class="card-body p-4 p-sm-5">
                
                <h3 class="card-title text-center mb-4 fw-light fs-4">Get in Touch</h3>

                <form method="POST" novalidate>
                  {{ form.hidden_tag() }}

                  <div class="form-floating mb-3">
                    {{ form.name(class="form-control", placeholder="Name") }}
                    {{ form.name.label() }}
                    {% for error in form.name.errors %}
                    <div class="text-danger mt-1">
                      <small>{{ error }}</small>
                    </div>
                    {% endfor %}
                  </div>

                  <div class="form-floating mb-3">
                    {{ form.email(class="form-control", placeholder="Email") }}
                    {{ form.email.label() }}
                    {% for error in form.email.errors %}
                    <div class="text-danger mt-1">
                      <small>{{ error }}</small>
                    </div>
                    {% endfor %}
                  </div>

                  <div class="form-floating mb-3">
                    {{ form.phone(class="form-control", placeholder="Phone") }}
                    {{ form.phone.label() }}
                    {% for error in form.phone.errors %}
                    <div class="text-danger mt-1">
                      <small>{{ error }}</small>
                    </div>
                    {% endfor %}
                  </div>

                  <div class="form-floating mb-4">
                    {{ form.message(class="form-control", style="height: 12rem", placeholder="Message") }}
                    {{ form.message.label() }}
                    {% for error in form.message.errors %}
                    <div class="text-danger mt-1">
                      <small>{{ error }}</small>
                    </div>
                    {% endfor %}
                  </div>

                  <div class="d-grid">
                      <button class="btn btn-primary btn-lg rounded-pill shadow-sm fw-bold" type="submit">
                        <i class="bi bi-send-fill me-2"></i>Send Message
                      </button>
                  </div>
                </form>

            </div>
        </div>
        </div>
    </div>
  </div>
</main>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", () => {
    // 1. Prioritize Flash Messages (Global Alerts)
    const flashMessage = document.querySelector(".alert.alert-dismissible");
    
    // 2. Look for Field Validation Errors
    // This strictly looks for the structure: <div class="text-danger"><small>Error</small></div>
    // This prevents false positives from red headers or other red text.
    const formError = document.querySelector(".text-danger small");

    // 3. Determine the target (Flash takes priority)
    const target = flashMessage || formError;

    if (target) {
      // Scroll the specific element into the center of the viewport
      target.scrollIntoView({ behavior: "smooth", block: "center" });
    }
  });
</script>
{% endblock %}
